@model Movie_Site_Management_System.Models.Hall
@{
    ViewData["Title"] = "Delete Hall";
    ViewBag.GlassHeader = true;

    var slotCount = (int?)ViewBag.SlotCount ?? 0;
    var seatCount = (int?)ViewBag.SeatCount ?? 0;
    var showCount = (int?)ViewBag.ShowCount ?? 0;
    var seatLinks = (int?)ViewBag.SeatLinks ?? 0;

    var hasHardDeps = (slotCount > 0) || (showCount > 0);
    var canDeleteSeats = (bool?)ViewBag.CanDeleteSeats ?? false; // seats>0 AND no links AND no shows
}

@section Styles {
    <link rel="stylesheet" href="~/css/admin-glass-ultra.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/hall/hall-crud.css" asp-append-version="true" />
}

<section class="admin-ultra-shell">
    <div class="film-rail film-rail--left"></div>
    <div class="film-rail film-rail--right"></div>
    <div class="ultra-aura"></div>
    <div class="film-grain"></div>

    <div class="container py-4 position-relative">
        <div class="ultra-card">
            <div class="ultra-card__shine"></div>

            <div class="ultra-card__header">
                <h2 class="ultra-title m-0"><span class="ultra-title__glow">Delete Hall</span></h2>
            </div>

            <div class="ultra-card__body">

                @if (TempData["Warning"] is string w && !string.IsNullOrWhiteSpace(w))
                {
                    <div class="alert alert-warning glass-alert ultra-alert">@w</div>
                }
                @if (TempData["Danger"] is string d && !string.IsNullOrWhiteSpace(d))
                {
                    <div class="alert alert-danger glass-alert ultra-alert">@d</div>
                }
                @if (TempData["Success"] is string s && !string.IsNullOrWhiteSpace(s))
                {
                    <div class="alert alert-success glass-alert ultra-alert">@s</div>
                }

                <div class="ultra-alert ultra-alert--warning">
                    <strong>Are you sure?</strong>
                    You are about to delete <em>@Model.Name</em> in theatre <em>@Model.Theatre?.Name</em>.
                </div>

                <div class="kv-dim mt-2" style="background: radial-gradient(120% 120% at 0% 0%, rgba(180,140,70,.25), rgba(0,0,0,0)); padding:1rem; border-radius:1rem;">
                    <div>Related items:</div>
                    <ul class="mb-0">
                        <li>Slots: <strong>@slotCount</strong></li>
                        <li>Seats: <strong>@seatCount</strong></li>
                        <li>Shows: <strong>@showCount</strong></li>
                    </ul>

                    @if (hasHardDeps)
                    {
                        <div class="alert alert-danger glass-alert ultra-alert mt-3">
                            Deletion is blocked because Shows and/or Slots exist. Remove them first.
                        </div>
                    }
                    else if (seatCount > 0 && seatLinks > 0)
                    {
                        <div class="alert alert-danger glass-alert ultra-alert mt-3">
                            Some seats are referenced by ShowSeats / BookingSeats / SeatBlocks. Remove those references first.
                        </div>
                    }
                    else if (seatCount == 0)
                    {
                        <div class="alert alert-info glass-alert ultra-alert mt-3">
                            No seats in this hall. You can delete the hall directly.
                        </div>
                    }
                    else if (canDeleteSeats)
                    {
                        <div class="alert alert-warning glass-alert ultra-alert mt-3">
                            This hall has <strong>@seatCount</strong> seats. You may delete them along with the hall.
                        </div>
                    }
                </div>

                <form asp-action="Delete" method="post" class="mt-3">
                    <input type="hidden" asp-for="HallId" name="id" value="@Model.HallId" />

                    @if (!hasHardDeps && seatCount > 0 && seatLinks == 0)
                    {
                        <div class="form-check my-3">
                            <input class="form-check-input" type="checkbox" id="deleteSeats" name="deleteSeats" value="true" />
                            <label class="form-check-label" for="deleteSeats">
                                Also delete seats (<strong>@seatCount</strong>)
                            </label>
                        </div>
                    }

                    <div class="d-flex gap-2 mt-2">
                        <button type="submit" class="btn btn-danger chip">Confirm Delete</button>
                        <!-- Cancel now goes to the Halls list -->
                        <a asp-action="Index" class="btn chip chip--muted">Cancel</a>
                    </div>

                    <p class="text-muted mt-2 mb-0">
                        <small>
                            Notes: Shows/Slots block deletion. If seats exist, tick “Also delete seats”.
                            If any seats are referenced by ShowSeats/Bookings/Blocks, remove those references first.
                        </small>
                    </p>
                </form>
            </div>
        </div>
    </div>
</section>
