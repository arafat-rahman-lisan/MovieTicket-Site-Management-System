@model Movie_Site_Management_System.ViewModels.Movies.MovieDetailsVM
@using Movie_Site_Management_System.Models

@{
    ViewData["Title"] = Model.Title;
}
<link rel="stylesheet" href="~/css/movie-details.css" asp-append-version="true" />

<section class="movie-details container py-4">
    <div class="row g-4">
        <!-- Poster -->
        <div class="col-md-4">
            <img src="@(Model.BigPoster ?? Model.PosterUrl ?? "/img/placeholder-big.jpg")"
                 alt="@Model.Title"
                 class="img-fluid rounded-3 shadow" />
        </div>

        <!-- Info -->
        <div class="col-md-8">
            <h2>@Model.Title</h2>
            <p class="text-muted mb-1">⭐ @(Model.Imdb?.ToString("0.0") ?? "0.0")</p>
            <p><strong>Genre:</strong> @Model.Genre</p>
            <p><strong>Year:</strong> @Model.Year</p>
            <p><strong>Runtime:</strong> @Model.RuntimeMinutes min</p>
            @if (!string.IsNullOrWhiteSpace(Model.RatingCertificate))
            {
                <p><strong>Certificate:</strong> @Model.RatingCertificate</p>
            }

            <div class="d-flex gap-2 my-3 flex-wrap">
                <a class="btn btn-primary">Show Time</a>
                <a class="btn btn-outline-secondary">Watch Trailer</a>
            </div>

            <h5>Synopsis</h5>
            <p>@(string.IsNullOrWhiteSpace(Model.Synopsis) ? "Coming soon..." : Model.Synopsis)</p>
        </div>
    </div>

    <hr class="my-4" />

    <h5 class="mb-3">Showtime</h5>

    @if (Model.TheatreOptions.Any())
    {
        <form method="get" asp-action="Details" asp-route-id="@Model.MovieId" class="mb-3">
            <select name="theatreId" class="form-select w-auto d-inline" onchange="this.form.submit()">
                @foreach (var t in Model.TheatreOptions)
                {
                    if (Model.SelectedTheatreId == t.TheatreId)
                    {
                        <option value="@t.TheatreId" selected>@t.TheatreName</option>
                    }
                    else
                    {
                        <option value="@t.TheatreId">@t.TheatreName</option>
                    }
                }
            </select>
        </form>
    }

    @if (Model.DateBlocks.Count == 0)
    {
        <div class="alert alert-warning">No upcoming shows scheduled.</div>
    }
    else
    {
        foreach (var block in Model.DateBlocks)
        {
            <div class="card my-3">
                <div class="card-header fw-semibold">
                    @block.Date.ToDateTime(new TimeOnly(0, 0)).ToString("dddd, dd MMMM yyyy")
                </div>

                <div class="card-body d-flex flex-wrap gap-2">
                    @foreach (var s in block.Items)
                    {
                        <a class="badge bg-warning text-dark p-2 text-decoration-none"
                           asp-controller="ShowSeats"
                           asp-action="Map"
                           asp-route-showId="@s.ShowId"
                           title="Get Tickets for @s.Hall at @s.StartTime.ToString("hh:mm tt")">
                            @s.StartTime.ToString("hh:mm tt") (@s.Hall)
                        </a>
                    }
                </div>

                <div class="card-footer">
                    <span class="text-muted">Pick a time above to get tickets.</span>
                </div>
            </div>
        }
    }
</section>
